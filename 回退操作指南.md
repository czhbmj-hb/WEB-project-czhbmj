# 版本回退操作指南

## ✅ 已完成的操作

### 1. Git 回退
**已成功回退到 `23b3dd0` 版本**（2025年11月3日 - 添加用户手册版本）

已移除的文件：
- ❌ `multi-image-manager.js` - 多图片管理模块
- ❌ `migrate_products_multi_images.sql` - 多图片数据库迁移脚本
- ❌ `claudedocs/MULTI_IMAGE_DEPLOYMENT_GUIDE.md` - 多图片部署指南

已还原的文件（回到单图片版本）：
- ✅ `index.html` - 产品表单回到单图片上传
- ✅ `script.js` - 移除多图片逻辑
- ✅ `styles.css` - 移除多图片样式
- ✅ `i18n.js` - 移除多图片翻译
- ✅ `supabase-client.js` - 移除批量上传图片功能

---

## 🔧 需要您执行的操作

### 步骤 1：还原数据库（重要！）

1. **打开 Supabase Dashboard**
   - 访问：https://supabase.com/dashboard/project/zoxjvuafzkymgxmsluif

2. **进入 SQL Editor**
   - 点击左侧菜单的 "SQL Editor"

3. **执行数据库回退脚本**
   - 打开项目中的 `ROLLBACK_DATABASE.sql` 文件
   - 复制所有内容
   - 粘贴到 SQL Editor
   - 点击 **Run** 执行

4. **验证结果**
   - 您应该看到：
     ```
     ✅ images 列已成功删除
     ✅ 触发器已成功删除
     ✅ 数据库已成功回退到单图片模式！
     ```

### 步骤 2：修复 Supabase API Key（必须！）

您之前的问题是 **Supabase ANON KEY 配置错误**，需要修复：

1. **获取正确的 API Key**
   - 在 Supabase Dashboard 中
   - 点击 **Settings** → **API**
   - 复制 **anon public** key（很长，以 `eyJ` 开头）

2. **更新 config.js**
   ```javascript
   // 编辑 config.js 第 9 行
   anonKey: window.ENV?.SUPABASE_ANON_KEY || '粘贴您的完整anon key'
   ```

### 步骤 3：确保有产品数据

如果数据库中没有产品，执行 `INSERT_DEFAULT_DATA.sql` 插入示例产品。

### 步骤 4：推送到 GitHub

在终端执行：
```bash
git push --force origin main
```

**注意**：使用 `--force` 是因为本地版本比远程版本旧。

### 步骤 5：等待 Vercel 自动部署

推送后，Vercel 会自动部署新版本（约 1-2 分钟）。

---

## 📋 检查清单

- [ ] 执行 `ROLLBACK_DATABASE.sql` 还原数据库
- [ ] 修复 config.js 中的 Supabase ANON KEY
- [ ] 确认数据库有产品数据
- [ ] 强制推送到 GitHub
- [ ] 等待 Vercel 部署完成
- [ ] 清除浏览器缓存（Ctrl+Shift+R）
- [ ] 测试网站功能

---

## 🎯 最终效果

回退后的网站将：
- ✅ 使用单图片模式（每个产品一张图片）
- ✅ 保留批量上传功能（Excel上传）
- ✅ 保留中英文双语支持
- ✅ 保留所有产品管理功能
- ❌ 没有多图片功能
- ❌ 没有拖拽排序
- ❌ 没有主图设置

---

## ⚠️ 重要提醒

1. **必须执行数据库回退脚本**，否则数据库结构与代码不匹配会导致错误
2. **必须修复 Supabase ANON KEY**，这是您之前无法显示数据的根本原因
3. **使用 --force 推送**会覆盖远程仓库的历史记录

---

## 如果遇到问题

1. **网站仍不显示数据**
   - 检查是否正确设置了 Supabase ANON KEY
   - 执行 `QUICK_CHECK.sql` 验证数据是否存在
   - 清除浏览器缓存

2. **数据库回退失败**
   - 检查是否有语法错误
   - 确认 products 表存在
   - 查看错误信息并反馈

3. **Git 推送失败**
   - 确保您有推送权限
   - 使用 `git push --force-with-lease` 作为更安全的选项